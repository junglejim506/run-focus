<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BREATHE.EXE - Terminal Breathing & Meditation System</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Courier+Prime:wght@400;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier Prime', monospace;
            background: #0a0a0a;
            color: #00ff41;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(0, 255, 65, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 255, 65, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(0, 255, 65, 0.03) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 787.5px;
            margin: 7.5px auto;
            padding: 15px 1vw;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            border: 2px solid #00ff41;
            padding: 10px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            box-shadow: 
                0 0 11px rgba(0, 255, 65, 0.3),
                inset 0 0 11px rgba(0, 255, 65, 0.1);
        }

        .header h1 {
            font-family: 'Orbitron', monospace;
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 6px;
            text-shadow: 
                0 0 6px #00ff41,
                0 0 10px #00ff41,
                0 0 13px #00ff41;
            letter-spacing: 1.5px;
        }

        .header p {
            font-size: 0.7rem;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #00ff41;
        }

        .app-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 22.5px;
            margin-bottom: 22.5px;
        }

        .terminal-window {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ff41;
            border-radius: 8px;
            padding: 0;
            box-shadow: 
                0 0 16.5px rgba(0, 255, 65, 0.4),
                inset 0 0 16.5px rgba(0, 255, 65, 0.05);
            position: relative;
            overflow: hidden;
        }

        .terminal-header {
            background: #00ff41;
            color: #000;
            padding: 6px 11px;
            font-weight: bold;
            font-size: 0.68rem;
            display: flex;
            align-items: center;
            gap: 7px;
            text-transform: uppercase;
            letter-spacing: 0.75px;
        }

        .terminal-header::before {
            content: '●●●';
            color: #000;
            font-size: 1.2rem;
        }

        .terminal-content {
            padding: 18px;
            min-height: 400px;
        }

        .terminal-prompt {
            color: #00ff41;
            font-weight: bold;
            margin-bottom: 11.25px;
            font-size: 0.825rem;
        }

        .terminal-prompt::before {
            content: '> ';
            color: #00ff41;
        }

        /* Breathing Visualizer */
        .breath-display {
            text-align: center;
            margin-bottom: 20px;
        }

        .breath-circle {
            width: 180px;
            height: 180px;
            border: 3px solid #00ff41;
            border-radius: 50%;
            margin: 0 auto 15px;
            position: relative;
            background: rgba(0, 255, 65, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 0 20px rgba(0, 255, 65, 0.3),
                inset 0 0 20px rgba(0, 255, 65, 0.1);
            transition: all 0.3s ease;
        }

        .breath-circle.inhale {
            transform: scale(1.2);
            box-shadow: 
                0 0 30px rgba(0, 255, 65, 0.6),
                inset 0 0 30px rgba(0, 255, 65, 0.2);
        }

        .breath-circle.exhale {
            transform: scale(0.8);
            box-shadow: 
                0 0 10px rgba(0, 255, 65, 0.2),
                inset 0 0 10px rgba(0, 255, 65, 0.05);
        }

        .breath-text {
            font-family: 'Orbitron', monospace;
            font-size: 1.2rem;
            font-weight: 700;
            color: #00ff41;
            text-shadow: 0 0 10px #00ff41;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .breath-counter {
            font-size: 0.8rem;
            margin-top: 10px;
            opacity: 0.8;
        }

        /* Technique Selection */
        .technique-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }

        .technique-btn {
            background: transparent;
            border: 1px solid rgba(0, 255, 65, 0.5);
            color: #00ff41;
            padding: 10px 8px;
            font-family: 'Courier Prime', monospace;
            font-size: 0.65rem;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.3s ease;
            text-align: center;
        }

        .technique-btn:hover,
        .technique-btn.active {
            border-color: #00ff41;
            background: rgba(0, 255, 65, 0.1);
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.3);
        }

        /* Controls */
        .breath-controls {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .terminal-btn {
            background: transparent;
            border: 1px solid #00ff41;
            color: #00ff41;
            padding: 8px 16px;
            font-family: 'Courier Prime', monospace;
            font-size: 0.7rem;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.75px;
            transition: all 0.3s ease;
            border-radius: 0;
        }

        .terminal-btn:hover {
            background: #00ff41;
            color: #000;
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.6);
        }

        .terminal-btn.active {
            background: #00ff41;
            color: #000;
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.6);
        }

        /* Settings */
        .settings-section {
            margin-top: 20px;
        }

        .setting-control {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 0.75rem;
        }

        .setting-value {
            font-weight: bold;
            color: #00ff41;
            text-shadow: 0 0 5px #00ff41;
        }

        .terminal-slider {
            width: 100%;
            height: 4px;
            background: rgba(0, 255, 65, 0.2);
            outline: none;
            -webkit-appearance: none;
            border-radius: 0;
            margin-top: 5px;
        }

        .terminal-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: #00ff41;
            cursor: pointer;
            border-radius: 0;
            box-shadow: 0 0 8px rgba(0, 255, 65, 0.6);
        }

        .terminal-slider::-moz-range-thumb {
            width: 12px;
            height: 12px;
            background: #00ff41;
            cursor: pointer;
            border: none;
            border-radius: 0;
            box-shadow: 0 0 8px rgba(0, 255, 65, 0.6);
        }

        /* Session Info */
        .session-info {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 255, 65, 0.3);
            padding: 12px;
            margin-top: 15px;
            font-size: 0.7rem;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .info-row:last-child {
            margin-bottom: 0;
        }

        /* Meditation Scripts */
        .meditation-content {
            max-height: 300px;
            overflow-y: auto;
        }

        .script-text {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 255, 65, 0.3);
            padding: 15px;
            margin-bottom: 15px;
            font-size: 0.75rem;
            line-height: 1.6;
            text-align: justify;
        }

        .script-title {
            color: #00ff41;
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Guided Session */
        .guided-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .duration-btn {
            background: transparent;
            border: 1px solid rgba(0, 255, 65, 0.7);
            color: #00ff41;
            padding: 6px 12px;
            font-family: 'Courier Prime', monospace;
            font-size: 0.65rem;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.3s ease;
        }

        .duration-btn:hover,
        .duration-btn.active {
            border-color: #00ff41;
            background: rgba(0, 255, 65, 0.1);
        }

        /* Progress Bar */
        .progress-section {
            margin-top: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(0, 255, 65, 0.2);
            border-radius: 0;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background: #00ff41;
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px #00ff41;
        }

        /* Full Width Sections */
        .full-width {
            grid-column: 1 / -1;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.5);
        }

        ::-webkit-scrollbar-thumb {
            background: #00ff41;
            border-radius: 0;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 255, 65, 0.8);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .app-grid {
                grid-template-columns: 1fr;
            }
            
            .technique-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .breath-circle {
                width: 140px;
                height: 140px;
            }
            
            .breath-controls {
                flex-direction: column;
                gap: 6px;
            }
            
            .guided-controls {
                flex-direction: column;
                gap: 6px;
            }
        }

        /* Animations */
        .glow {
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from {
                text-shadow: 0 0 5px #00ff41, 0 0 10px #00ff41, 0 0 15px #00ff41;
            }
            to {
                text-shadow: 0 0 10px #00ff41, 0 0 20px #00ff41, 0 0 30px #00ff41;
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        .return-terminal-wrapper {
            display: flex;
            justify-content: center;
            margin: 24px 0 6px 0;
        }
        .return-terminal-btn {
            background: #00ff41;
            color: #000;
            border: 2px solid #00ff41;
            font-family: 'Orbitron', monospace;
            font-weight: bold;
            font-size: 1rem;
            padding: 8px 28px;
            border-radius: 6px;
            text-decoration: none;
            letter-spacing: 1.5px;
            box-shadow: 0 0 12px #00ff41, 0 0 4px #00ff41 inset;
            transition: background 0.2s, color 0.2s, box-shadow 0.2s;
        }
        .return-terminal-btn:hover {
            background: #000;
            color: #00ff41;
            box-shadow: 0 0 18px #00ff41, 0 0 6px #00ff41 inset;
        }
        .terminal-footer-block {
            text-align: center;
            margin-top: 30px;
            margin-bottom: 8px;
            opacity: 0.6;
            font-size: 0.8rem;
        }
        .matrix-cursor {
            display: inline-block;
            font-family: 'Orbitron', monospace;
            color: #00ff41;
            letter-spacing: 2px;
            margin-bottom: 2px;
        }
        .matrix-cursor::after {
            content: '_';
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        .terminal-footer-version {
            margin-top: 8px;
            color: #00ff41;
            font-family: 'Orbitron', monospace;
            letter-spacing: 1.5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="glow">BREATHE.EXE</h1>
            <p>[ TERMINAL BREATHING & MEDITATION SYSTEM v2.0 ]</p>
        </div>

        <div class="app-grid">
            <!-- Breathing Exercise -->
            <div class="terminal-window">
                <div class="terminal-header">
                    <span>BREATH.SYS</span>
                </div>
                <div class="terminal-content">
                    <div class="terminal-prompt">BREATHING PROTOCOL</div>
                    
                    <div class="breath-display">
                        <div class="breath-circle" id="breathCircle">
                            <div class="breath-text" id="breathText">READY</div>
                        </div>
                        <div class="breath-counter" id="breathCounter">CYCLES: 0</div>
                    </div>

                    <div class="technique-grid">
                        <button class="technique-btn active" data-technique="box">BOX 4-4-4-4</button>
                        <button class="technique-btn" data-technique="calm">CALM 4-7-8</button>
                        <button class="technique-btn" data-technique="energy">ENERGY 4-4-4</button>
                        <button class="technique-btn" data-technique="wimhof">WIM HOF</button>
                    </div>

                    <div class="breath-controls">
                        <button class="terminal-btn" id="startBreathBtn">START</button>
                        <button class="terminal-btn" id="pauseBreathBtn">PAUSE</button>
                        <button class="terminal-btn" id="resetBreathBtn">RESET</button>
                    </div>

                    <div class="settings-section">
                        <div class="setting-control">
                            <span>BREATHING SPEED</span>
                            <span class="setting-value" id="speedValue">NORMAL</span>
                        </div>
                        <input type="range" class="terminal-slider" id="speedSlider" min="0.5" max="2" step="0.1" value="1">
                        
                        <div class="setting-control" style="margin-top: 15px;">
                            <span>SESSION LENGTH</span>
                            <span class="setting-value" id="lengthValue">5 MIN</span>
                        </div>
                        <input type="range" class="terminal-slider" id="lengthSlider" min="1" max="20" value="5">
                    </div>

                    <div class="session-info">
                        <div class="info-row">
                            <span>TECHNIQUE:</span>
                            <span id="currentTechnique">BOX BREATHING</span>
                        </div>
                        <div class="info-row">
                            <span>TIME REMAINING:</span>
                            <span id="timeRemaining">05:00</span>
                        </div>
                        <div class="info-row">
                            <span>BREATHS/MIN:</span>
                            <span id="breathsPerMin">6</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Guided Meditation -->
            <div class="terminal-window">
                <div class="terminal-header">
                    <span>MEDITATE.SYS</span>
                </div>
                <div class="terminal-content">
                    <div class="terminal-prompt">GUIDED MEDITATION PROTOCOL</div>
                    
                    <div class="guided-controls">
                        <button class="duration-btn active" data-duration="5">5 MIN</button>
                        <button class="duration-btn" data-duration="10">10 MIN</button>
                        <button class="duration-btn" data-duration="15">15 MIN</button>
                        <button class="duration-btn" data-duration="20">20 MIN</button>
                    </div>

                    <div class="meditation-content">
                        <div class="script-text" id="meditationScript">
                            <div class="script-title">FOCUS MEDITATION</div>
                            <p>Welcome to your meditation session. Find a comfortable position and close your eyes. Begin by taking three deep, cleansing breaths...</p>
                            <br>
                            <p>Notice your natural breathing pattern. Don't try to change it, simply observe each inhale and exhale...</p>
                            <br>
                            <p>When your mind wanders, gently bring your attention back to your breath. This is normal and part of the practice...</p>
                        </div>
                    </div>

                    <div class="breath-controls">
                        <button class="terminal-btn" id="startMeditationBtn">START SESSION</button>
                        <button class="terminal-btn" id="pauseMeditationBtn">PAUSE</button>
                        <button class="terminal-btn" id="stopMeditationBtn">STOP</button>
                    </div>

                    <div class="progress-section">
                        <div class="setting-control">
                            <span>SESSION PROGRESS</span>
                            <span class="setting-value" id="progressPercent">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- HRV & Stress Monitor -->
            <div class="terminal-window full-width">
                <div class="terminal-header">
                    <span>WELLNESS.SYS</span>
                </div>
                <div class="terminal-content">
                    <div class="terminal-prompt">HEART RATE VARIABILITY & STRESS MONITOR</div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                        <div>
                            <div class="category-title" style="color: #00ff41; margin-bottom: 10px; text-transform: uppercase; font-size: 0.75rem;">HRV SIMULATION</div>
                            <div style="text-align: center;">
                                <div style="font-size: 2rem; font-weight: bold; color: #00ff41; text-shadow: 0 0 10px #00ff41;" id="hrvValue">52</div>
                                <div style="font-size: 0.7rem; opacity: 0.8;">HRV SCORE</div>
                            </div>
                            <div style="margin-top: 15px;">
                                <div style="font-size: 0.7rem; margin-bottom: 5px;">COHERENCE LEVEL</div>
                                <div class="progress-bar" style="height: 8px;">
                                    <div class="progress-fill" id="coherenceFill" style="width: 65%;"></div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <div class="category-title" style="color: #00ff41; margin-bottom: 10px; text-transform: uppercase; font-size: 0.75rem;">STRESS LEVEL</div>
                            <div style="text-align: center;">
                                <div style="font-size: 2rem; font-weight: bold; color: #00ff41; text-shadow: 0 0 10px #00ff41;" id="stressValue">LOW</div>
                                <div style="font-size: 0.7rem; opacity: 0.8;">CURRENT STATE</div>
                            </div>
                            <div style="margin-top: 15px;">
                                <div style="font-size: 0.7rem; margin-bottom: 5px;">STRESS INDEX</div>
                                <div class="progress-bar" style="height: 8px;">
                                    <div class="progress-fill" id="stressFill" style="width: 25%; background: #4ade80;"></div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <div class="category-title" style="color: #00ff41; margin-bottom: 10px; text-transform: uppercase; font-size: 0.75rem;">SESSION STATS</div>
                            <div style="font-size: 0.7rem;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span>TOTAL BREATHS:</span>
                                    <span id="totalBreaths">0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span>AVG BPM:</span>
                                    <span id="avgBpm">6</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span>SESSION TIME:</span>
                                    <span id="sessionTime">00:00</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span>IMPROVEMENT:</span>
                                    <span id="improvement" style="color: #4ade80;">+12%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class BreathingSystem {
            constructor() {
                this.isBreathing = false;
                this.isPaused = false;
                this.breathCount = 0;
                this.sessionStartTime = null;
                this.currentPhase = 'ready';
                this.cycleCount = 0;
                this.speed = 1;
                this.sessionLength = 5; // minutes
                this.currentTechnique = 'box';
                this.phaseIndex = 0;
                this.phaseTimer = null;
                this.sessionTimer = null;
                this.totalBreaths = 0;
                
                this.techniques = {
                    box: {
                        name: 'BOX BREATHING',
                        phases: [
                            { name: 'INHALE', duration: 4000, action: 'inhale' },
                            { name: 'HOLD', duration: 4000, action: 'hold' },
                            { name: 'EXHALE', duration: 4000, action: 'exhale' },
                            { name: 'HOLD', duration: 4000, action: 'hold' }
                        ],
                        bpm: 6
                    },
                    calm: {
                        name: '4-7-8 CALMING',
                        phases: [
                            { name: 'INHALE', duration: 4000, action: 'inhale' },
                            { name: 'HOLD', duration: 7000, action: 'hold' },
                            { name: 'EXHALE', duration: 8000, action: 'exhale' }
                        ],
                        bpm: 4
                    },
                    energy: {
                        name: 'ENERGIZING',
                        phases: [
                            { name: 'INHALE', duration: 4000, action: 'inhale' },
                            { name: 'HOLD', duration: 4000, action: 'hold' },
                            { name: 'EXHALE', duration: 4000, action: 'exhale' }
                        ],
                        bpm: 8
                    },
                    wimhof: {
                        name: 'WIM HOF METHOD',
                        phases: [
                            { name: 'POWER BREATHE', duration: 2000, action: 'inhale' },
                            { name: 'RELEASE', duration: 2000, action: 'exhale' }
                        ],
                        bpm: 15
                    }
                };

                this.initializeElements();
                this.updateTechniqueInfo();
                this.startWellnessMonitoring();
            }

            initializeElements() {
                // Breathing elements
                this.breathCircle = document.getElementById('breathCircle');
                this.breathText = document.getElementById('breathText');
                this.breathCounter = document.getElementById('breathCounter');
                this.startBreathBtn = document.getElementById('startBreathBtn');
                this.pauseBreathBtn = document.getElementById('pauseBreathBtn');
                this.resetBreathBtn = document.getElementById('resetBreathBtn');

                // Technique buttons
                this.techniqueBtns = document.querySelectorAll('.technique-btn');

                // Controls
                this.speedSlider = document.getElementById('speedSlider');
                this.lengthSlider = document.getElementById('lengthSlider');
                this.speedValue = document.getElementById('speedValue');
                this.lengthValue = document.getElementById('lengthValue');

                // Info displays
                this.currentTechniqueDisplay = document.getElementById('currentTechnique');
                this.timeRemainingDisplay = document.getElementById('timeRemaining');
                this.breathsPerMinDisplay = document.getElementById('breathsPerMin');

                // Meditation elements
                this.startMeditationBtn = document.getElementById('startMeditationBtn');
                this.pauseMeditationBtn = document.getElementById('pauseMeditationBtn');
                this.stopMeditationBtn = document.getElementById('stopMeditationBtn');
                this.durationBtns = document.querySelectorAll('.duration-btn');
                this.progressFill = document.getElementById('progressFill');
                this.progressPercent = document.getElementById('progressPercent');
                this.meditationScript = document.getElementById('meditationScript');

                // Wellness displays
                this.hrvValue = document.getElementById('hrvValue');
                this.stressValue = document.getElementById('stressValue');
                this.coherenceFill = document.getElementById('coherenceFill');
                this.stressFill = document.getElementById('stressFill');
                this.totalBreathsDisplay = document.getElementById('totalBreaths');
                this.avgBpmDisplay = document.getElementById('avgBpm');
                this.sessionTimeDisplay = document.getElementById('sessionTime');
                this.improvementDisplay = document.getElementById('improvement');

                this.attachEventListeners();
            }

            attachEventListeners() {
                // Breathing controls
                this.startBreathBtn.addEventListener('click', () => this.startBreathing());
                this.pauseBreathBtn.addEventListener('click', () => this.pauseBreathing());
                this.resetBreathBtn.addEventListener('click', () => this.resetBreathing());

                // Technique selection
                this.techniqueBtns.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.selectTechnique(e.target.dataset.technique);
                        this.updateActiveButton(this.techniqueBtns, e.target);
                    });
                });

                // Settings
                this.speedSlider.addEventListener('input', (e) => {
                    this.speed = parseFloat(e.target.value);
                    this.updateSpeedDisplay();
                });

                this.lengthSlider.addEventListener('input', (e) => {
                    this.sessionLength = parseInt(e.target.value);
                    this.lengthValue.textContent = `${this.sessionLength} MIN`;
                    this.updateTimeRemaining();
                });

                // Meditation controls
                this.startMeditationBtn.addEventListener('click', () => this.startMeditation());
                this.pauseMeditationBtn.addEventListener('click', () => this.pauseMeditation());
                this.stopMeditationBtn.addEventListener('click', () => this.stopMeditation());

                // Duration selection
                this.durationBtns.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.meditationDuration = parseInt(e.target.dataset.duration);
                        this.updateActiveButton(this.durationBtns, e.target);
                    });
                });
            }

            selectTechnique(technique) {
                this.currentTechnique = technique;
                this.updateTechniqueInfo();
                if (this.isBreathing) {
                    this.resetBreathing();
                }
            }

            updateTechniqueInfo() {
                const technique = this.techniques[this.currentTechnique];
                this.currentTechniqueDisplay.textContent = technique.name;
                this.breathsPerMinDisplay.textContent = Math.round(technique.bpm / this.speed);
                this.avgBpmDisplay.textContent = Math.round(technique.bpm / this.speed);
            }

            updateSpeedDisplay() {
                const speedLabels = {
                    0.5: 'VERY SLOW',
                    0.6: 'SLOW',
                    0.7: 'SLOW',
                    0.8: 'SLOW',
                    0.9: 'SLOW',
                    1.0: 'NORMAL',
                    1.1: 'FAST',
                    1.2: 'FAST',
                    1.3: 'FAST',
                    1.4: 'FAST',
                    1.5: 'VERY FAST',
                    1.6: 'VERY FAST',
                    1.7: 'VERY FAST',
                    1.8: 'VERY FAST',
                    1.9: 'VERY FAST',
                    2.0: 'VERY FAST'
                };
                
                this.speedValue.textContent = speedLabels[this.speed.toFixed(1)] || 'NORMAL';
                this.updateTechniqueInfo();
            }

            updateTimeRemaining() {
                if (this.sessionStartTime) {
                    const elapsed = (Date.now() - this.sessionStartTime) / 1000 / 60;
                    const remaining = Math.max(0, this.sessionLength - elapsed);
                    const minutes = Math.floor(remaining);
                    const seconds = Math.floor((remaining - minutes) * 60);
                    this.timeRemainingDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    if (remaining <= 0) {
                        this.completeSession();
                    }
                } else {
                    this.timeRemainingDisplay.textContent = `${this.sessionLength.toString().padStart(2, '0')}:00`;
                }
            }

            startBreathing() {
                if (!this.isBreathing) {
                    this.isBreathing = true;
                    this.isPaused = false;
                    this.sessionStartTime = Date.now();
                    this.phaseIndex = 0;
                    this.startBreathBtn.classList.add('active');
                    this.runBreathingCycle();
                    
                    // Start session timer
                    this.sessionTimer = setInterval(() => {
                        this.updateTimeRemaining();
                        this.updateSessionTime();
                    }, 1000);
                }
            }

            pauseBreathing() {
                if (this.isBreathing) {
                    this.isPaused = !this.isPaused;
                    
                    if (this.isPaused) {
                        clearTimeout(this.phaseTimer);
                        this.pauseBreathBtn.classList.add('active');
                        this.breathText.textContent = 'PAUSED';
                        this.breathCircle.className = 'breath-circle';
                    } else {
                        this.pauseBreathBtn.classList.remove('active');
                        this.runBreathingCycle();
                    }
                }
            }

            resetBreathing() {
                this.isBreathing = false;
                this.isPaused = false;
                this.breathCount = 0;
                this.cycleCount = 0;
                this.phaseIndex = 0;
                this.sessionStartTime = null;
                
                clearTimeout(this.phaseTimer);
                clearInterval(this.sessionTimer);
                
                this.startBreathBtn.classList.remove('active');
                this.pauseBreathBtn.classList.remove('active');
                
                this.breathText.textContent = 'READY';
                this.breathCircle.className = 'breath-circle';
                this.breathCounter.textContent = 'CYCLES: 0';
                this.totalBreathsDisplay.textContent = '0';
                this.updateTimeRemaining();
                this.updateSessionTime();
            }

            runBreathingCycle() {
                if (!this.isBreathing || this.isPaused) return;

                const technique = this.techniques[this.currentTechnique];
                const phase = technique.phases[this.phaseIndex];
                const duration = phase.duration / this.speed;

                this.breathText.textContent = phase.name;
                
                // Apply visual effects
                this.breathCircle.className = 'breath-circle';
                if (phase.action === 'inhale') {
                    this.breathCircle.classList.add('inhale');
                } else if (phase.action === 'exhale') {
                    this.breathCircle.classList.add('exhale');
                }

                // Move to next phase
                this.phaseTimer = setTimeout(() => {
                    this.phaseIndex = (this.phaseIndex + 1) % technique.phases.length;
                    
                    // Complete cycle when back to beginning
                    if (this.phaseIndex === 0) {
                        this.cycleCount++;
                        this.totalBreaths++;
                        this.breathCounter.textContent = `CYCLES: ${this.cycleCount}`;
                        this.totalBreathsDisplay.textContent = this.totalBreaths.toString();
                    }
                    
                    this.runBreathingCycle();
                }, duration);
            }

            completeSession() {
                this.resetBreathing();
                this.breathText.textContent = 'COMPLETE';
                // Could add completion sound or notification here
            }

            updateSessionTime() {
                if (this.sessionStartTime) {
                    const elapsed = (Date.now() - this.sessionStartTime) / 1000;
                    const minutes = Math.floor(elapsed / 60);
                    const seconds = Math.floor(elapsed % 60);
                    this.sessionTimeDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                } else {
                    this.sessionTimeDisplay.textContent = '00:00';
                }
            }

            // Meditation functions
            startMeditation() {
                this.meditationActive = true;
                this.meditationStartTime = Date.now();
                this.startMeditationBtn.classList.add('active');
                
                this.updateMeditationScript();
                
                this.meditationTimer = setInterval(() => {
                    this.updateMeditationProgress();
                }, 1000);
            }

            pauseMeditation() {
                if (this.meditationActive) {
                    this.meditationPaused = !this.meditationPaused;
                    this.pauseMeditationBtn.classList.toggle('active');
                }
            }

            stopMeditation() {
                this.meditationActive = false;
                this.meditationPaused = false;
                clearInterval(this.meditationTimer);
                
                this.startMeditationBtn.classList.remove('active');
                this.pauseMeditationBtn.classList.remove('active');
                this.progressFill.style.width = '0%';
                this.progressPercent.textContent = '0%';
            }

            updateMeditationProgress() {
                if (!this.meditationActive || this.meditationPaused) return;
                
                const elapsed = (Date.now() - this.meditationStartTime) / 1000 / 60;
                const duration = this.meditationDuration || 5;
                const progress = Math.min(100, (elapsed / duration) * 100);
                
                this.progressFill.style.width = `${progress}%`;
                this.progressPercent.textContent = `${Math.round(progress)}%`;
                
                if (progress >= 100) {
                    this.stopMeditation();
                }
            }

            updateMeditationScript() {
                const scripts = {
                    5: {
                        title: 'QUICK FOCUS SESSION',
                        content: `
                            <p>Welcome to your 5-minute focus meditation. Find a comfortable position and close your eyes.</p>
                            <br>
                            <p>Begin by taking three deep, cleansing breaths. With each exhale, release any tension you're holding.</p>
                            <br>
                            <p>Now, notice your natural breathing pattern. Don't try to change it, simply observe each inhale and exhale.</p>
                            <br>
                            <p>When your mind wanders to thoughts, plans, or worries, gently acknowledge them and return your attention to your breath.</p>
                            <br>
                            <p>Continue focusing on your breath for the remainder of the session. This simple practice strengthens your ability to concentrate.</p>
                        `
                    },
                    10: {
                        title: 'DEEP RELAXATION SESSION',
                        content: `
                            <p>Welcome to your 10-minute deep relaxation meditation. Settle into a comfortable position and allow your eyes to close.</p>
                            <br>
                            <p>Start with five slow, deep breaths. With each exhale, feel yourself sinking deeper into relaxation.</p>
                            <br>
                            <p>Begin to scan your body from the top of your head down to your toes. Notice any areas of tension and consciously relax them.</p>
                            <br>
                            <p>Continue breathing naturally and allow your body to become completely relaxed. If you notice tension creeping back in, simply breathe into that area and let it go.</p>
                            <br>
                            <p>Rest in this state of deep relaxation, knowing that you are exactly where you need to be in this moment.</p>
                        `
                    },
                    15: {
                        title: 'MINDFULNESS MEDITATION',
                        content: `
                            <p>Welcome to your 15-minute mindfulness meditation. Take a moment to find your most comfortable meditation posture.</p>
                            <br>
                            <p>Begin by establishing your breathing rhythm. Take several conscious breaths, allowing each one to anchor you in the present moment.</p>
                            <br>
                            <p>Expand your awareness to include sounds around you, sensations in your body, and the feeling of sitting or lying down.</p>
                            <br>
                            <p>Practice being fully present with whatever arises - thoughts, emotions, sensations - without trying to change anything.</p>
                            <br>
                            <p>When you notice your mind has wandered, simply return to your breath and this moment. This returning is the practice.</p>
                            <br>
                            <p>Continue cultivating this open, accepting awareness for the remainder of your session.</p>
                        `
                    },
                    20: {
                        title: 'COMPREHENSIVE MEDITATION',
                        content: `
                            <p>Welcome to your 20-minute comprehensive meditation session. This is a gift of time you're giving to yourself.</p>
                            <br>
                            <p>Begin by finding your breath and following it for several minutes. Let each breath serve as an anchor to the present moment.</p>
                            <br>
                            <p>Next, expand your practice to include loving-kindness. Send wishes of peace and happiness to yourself, then to loved ones, then to all beings.</p>
                            <br>
                            <p>Return to breath awareness, but now include the entire experience of breathing - the pause between breaths, the texture of each inhale and exhale.</p>
                            <br>
                            <p>In the final portion, rest in open awareness. Be present with whatever arises without judgment or the need to fix or change anything.</p>
                            <br>
                            <p>Simply be. Rest in the spaciousness of your own awareness.</p>
                        `
                    }
                };

                const duration = this.meditationDuration || 5;
                const script = scripts[duration] || scripts[5];
                
                this.meditationScript.innerHTML = `
                    <div class="script-title">${script.title}</div>
                    ${script.content}
                `;
            }

            // Wellness monitoring simulation
            startWellnessMonitoring() {
                this.meditationDuration = 5;
                this.updateMeditationScript();
                
                // Simulate HRV and stress data
                setInterval(() => {
                    this.updateWellnessData();
                }, 2000);
            }

            updateWellnessData() {
                // Simulate realistic HRV values (30-100 range)
                const baseHRV = 52;
                const variation = this.isBreathing ? 15 : 5;
                const hrv = baseHRV + (Math.random() - 0.5) * variation;
                this.hrvValue.textContent = Math.round(hrv);
                
                // Update coherence based on breathing
                const coherence = this.isBreathing ? 65 + Math.random() * 25 : 50 + Math.random() * 20;
                this.coherenceFill.style.width = `${Math.min(100, coherence)}%`;
                
                // Simulate stress level
                const stressLevels = ['VERY LOW', 'LOW', 'MODERATE', 'HIGH'];
                const stressIndex = this.isBreathing ? 0 : Math.floor(Math.random() * 2);
                this.stressValue.textContent = stressLevels[stressIndex];
                
                const stressPercent = this.isBreathing ? 15 + Math.random() * 15 : 25 + Math.random() * 25;
                this.stressFill.style.width = `${stressPercent}%`;
                
                // Update stress fill color based on level
                if (stressPercent < 30) {
                    this.stressFill.style.background = '#4ade80';
                } else if (stressPercent < 60) {
                    this.stressFill.style.background = '#fbbf24';
                } else {
                    this.stressFill.style.background = '#ef4444';
                }
                
                // Update improvement percentage
                const improvement = this.isBreathing ? 12 + Math.random() * 10 : 5 + Math.random() * 5;
                this.improvementDisplay.textContent = `+${Math.round(improvement)}%`;
            }

            updateActiveButton(buttons, activeButton) {
                buttons.forEach(btn => btn.classList.remove('active'));
                activeButton.classList.add('active');
            }
        }

        // Initialize the breathing system
        document.addEventListener('DOMContentLoaded', function() {
            const breathingSystem = new BreathingSystem();
            
            console.log('BREATHE.EXE v2.0 - TERMINAL BREATHING & MEDITATION SYSTEM');
            console.log('System initialized successfully...');
            console.log('All breathing protocols loaded and ready for operation.');
        });
    </script>

    <div class="return-terminal-wrapper">
        <a href="index.html" class="return-terminal-btn">Return to Terminal</a>
    </div>
    <div class="terminal-footer-block">
        <div class="matrix-cursor">BREATH MODULE READY</div>
        <div class="terminal-footer-version">PRODUCTIVITY.SUITE.v2.1 | MATRIX.AESTHETIC | WEB.NATIVE</div>
    </div>
</body>
</html>